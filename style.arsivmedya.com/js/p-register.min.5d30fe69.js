$(function(){function a(){function a(a){a.preventDefault();var c=formUtils.preflightValidate(N);if(c&&!U){U=!0;var d=P.email.val();formUtils.preflightEnrich(d,!0).then(function(a){var c=$(".js-step.active"),d=c.next(".js-step"),e=d.data("step");d.length>0?(a&&B(a),V=!0,q(e)):(V=!1,b())})}}function b(){u(),v(),r(),K(),W&&(i(),webutils.track({siteCategory:M,eventName:"PartialLead_True"})),P.elqFormName.val(X);var a={enrich:!1,form:N,trackingParams:{trackingSiteCategory:M,trackingEventName:"TrialRegistration",dataLayerEventName:e(),trackingValueDataKey:"trial_type",trackingValueDataValue:t(Z.chosenTrial)}};q("loading"),p()&&(i(),formUtils.createLead(a),window.optimizely=window.optimizely||[],window.optimizely.push({type:"event",eventName:e()})),w().then(function(){E()}).catch(function(){F()})}var c=N.find(".js-submit-btn");formUtils.defaultInlineValidation(N),formUtils.regionalFieldDisplay(N,Q),formUtils.registerFieldHandlersToSaveInput(),formUtils.prepopulateCountryField(P.country),formUtils.prepopulatePostalCodeField(P.postal),formUtils.prepopulateLanguageField(P.language),formUtils.populateHiddenFields(P),formUtils.prepopulateFieldsFromLocalStorage(function(a){a.is(".js-change-context")&&a.trigger("change")}),formUtils.registerTimeOnForm(N,c),formUtils.setMAVs(!0),webutils.paramsForEloqua(),c.on("click",a)}function b(a){var b=!0,d={};return Z.trialSource&&(a=Y[Z.trialSource].productList),a||(a=[Z.defaultTrial]),a.forEach(function(a){"undefined"==typeof Y[a]&&(b=!1)}),b?(a=a.sort(),d.productList=a,d.chosenTrial=c(a),d.isSuiteTrial=Y[d.chosenTrial].trialProducts.indexOf("zendesk_suite")>-1,d.sellIntent=Y[d.chosenTrial].trialProducts.indexOf("zendesk_sell")>-1,d):void console.warn("Invalid product name passed",a)}function c(a){for(var b in Y){var c=j(a,Y[b].productList);if(c)return b}}function d(){return Y[Z.chosenTrial].trialProducts}function e(){var a="trial_created",b="",c={support_trial_created:"trial_created",sell_support_trial_created:"support_sell_trial_created",sell_suite_trial_created:"supportsuite_sell_trial_created"};return Z.productList.forEach(function(a){var c=a.replace("zendesk_",""),d=c+"_";b+=d}),b+=a,c[b]?c[b]:b}function f(){var a=window.location.pathname.split("/"),b=a.pop()||a.pop();return"register"===b?($('.js-contextual-field[data-context="zendesk_support"]').remove(),void(R=N.find(".js-contextual-field"))):(P.trialExtras.buyNow.val("true"),void P.trialExtras.plan.val(b))}function g(){return Y[Z.chosenTrial].supportTrialType}function h(){var a=$(".js-sell-disclaimer");geoUtils.isUserInRegion("APAC").then(function(b){b&&Z.sellIntent?a.css("display","flex"):a.css("display","none")})}function i(){var a=d();dataLayer.push({dimension17:a})}function j(a,b){var c=a.sort(),d=b.sort();if(c.length!==d.length)return!1;for(var e=0;e<c.length;e++)if(c[e]!=d[e])return!1;return!0}function k(){$.ajax({url:webutils.appUrl("lotusassets.json"),type:"GET",cache:!1}).done(function(a,b,c){var d=c.getResponseHeader("Token");webutils.csrfToken(d)})}function l(){var a="zendesk_suite",b=webutils.getParameterByName("domain")!==-1?webutils.getParameterByName("domain"):window.location.hostname;return geoUtils.getGeoData().then(function(c){geoLocation=c;var d="LATAM";(c.region===d||geoUtils.domainInfo[b]&&geoUtils.domainInfo[b].region===d)&&(a="zendesk_support"),"IN"===c.country_code&&P.jobTitle&&Q.jobTitle.addClass("active");var e="APAC",f=["AU","NZ","SG","JP","KR"];(f.indexOf(c.country_code)===-1&&c.region===e||geoUtils.domainInfo[b]&&f.indexOf(geoUtils.domainInfo[b].country)===-1&&geoUtils.domainInfo[b].region===e)&&(a="zendesk_support"),n(a),o()}).catch(function(b){n(a),o(),console.log(b)})}function m(){var a=webutils.getURLParameter("source"),b=a.replace(/[^a-z_]/g,"");return"undefined"==typeof Y[b]?null:b}function n(a){Z.defaultTrial=a}function o(a){"string"==typeof a&&(a=[a]);var c=b(a);$.extend(Z,c),N.trigger({type:"contextChange"})}function p(){var a=P.email.val().toLowerCase(),b=P.company.val().toLowerCase();return a.indexOf("@zendesk")===-1&&b.indexOf("z3n")===-1&&b.indexOf("k3n")===-1&&(window.optimizely&&optimizely.push(["setDimensionValue","lead","lead"]),!0)}function q(a,b){var c=$(".js-steppable"),d=c.filter(":visible"),e=c.filter(".active"),f=e.filter(":visible"),g=c.filter('[data-step="'+a+'"]');if(0===g.length)return!1;if(f.length!==d.length)return setTimeout(function(){q(a)},1500),!1;var h=new Promise(function(a,b){0===f.length&&a(),e.removeClass("active"),a()});return h.then(function(){function c(a,b){O.show(),O.find(".progress-bar div").removeClass().addClass(a).addClass("progress-bar-transition"),O.find(".progress-text span").html(b)}if(g.addClass("active"),window.isBreakpointUp("small")||g.not(":visible").trigger("animationend"),U=!1,O.length)switch(a){case"step-1":c(a,"1");break;case"step-2":c(a,"2");break;case"step-3":c(a,"3");break;case"loading":c(a,"3");break;default:O.hide()}var d=b?"replaceState":"pushState";history[d]({prevStep:f.data("step"),thisStep:a},"","#"+a),p()&&(i(),webutils.track({siteCategory:M,eventName:g.data("analytics-name")+"_View"})),0!==g.find(".js-field").length&&g.find(".js-field").first().focus()}).catch(function(a){console.error(a)}),g}function r(){formUtils.setFullNameField(N),Z.sellIntent&&P.trialExtras.sellSignupEnv.val("web"),P.supportTrialType.val(g()),P.suiteTrial.val(Z.isSuiteTrial),P.trialExtras.suiteTrial.val(Z.isSuiteTrial),P.trialExtras.behavioral1.val("");var a=webutils.getCurrency();P.currency.val(a),Object.keys(T).forEach(function(a){var b=T[a].val();N.find('input[name="trial_extras['+a+']"]').val(b)});var b=(new Date).getTimezoneOffset()/60*-1;if(P.utcOffset.val(b),P.hiddenLanguage.val(P.language.val()),Z.trialSource&&Z.trialSource.length>0){var c=Z.trialSource.replace(/[^\w\-]/g,"").substring(0,50);P.source.val(c),P.referralSource.val(c),"zopim"===Z.trialSource&&(P.trialExtras.xsellSource.val("zendesk_chat"),X="chatxsell")}var e=s();P.trialExtras.leadSourceDetail.val(e),Z.trialSource&&P.trialExtras.productSignUp.val(Z.trialSource),P.trialExtras.productList.val(Z.productList),P.trialExtras.provisionedTrial.val(d())}function s(){return Y[Z.chosenTrial].leadSourceDetail}function t(a){switch(a=a&&"null"!==a?a:defaultTrial){case"zendesk_support":return"support_first";case"zendesk_talk":return"talk_first";case"zendesk_guide":return"guide_first";case"zendesk_chat":return"chat_first";case"zendesk_suite":return"suite_first";case"zendesk_suite_14":return"suite_14_first";case"zendesk_sunshine":return"sunshine_first";case"zendesk_gather":return"gather_first";case"zendesk_sell":return"sell_first";case"zendesk_support_sell":return"support_sell_first";case"zendesk_supportsuite_sell":return"supportsuite_sell_first";case"zendesk_salessuite":return"salessuite_first";default:return""}}function u(){if($.cookie("flight")){var a=JSON.parse($.cookie("flight")),b=P.subdomain.val(),c=location.hostname.substr(location.hostname.indexOf(".")+1);a.trials++,a.domain=b,$.cookie("flight",JSON.stringify(a),{expires:730,path:"/",domain:c})}}function v(){var a=P.subdomain.val().replace(formUtils.SUBDOMAIN_REGEX,"").toLowerCase().replace(/^[\-]*/,"").replace("xn--","").substring(0,50);P.subdomain.val(a);var b=P.phone.val().replace(/[^0-9]/g,"");P.phone.val(b)}function w(){return new Promise(function(a,b){!function(){var a=P.email.val();window.Bizible=window.Bizible||{_queue:[],Push:function(a,b){this._queue.push({type:a,data:b})}},Bizible.Push("User",{email:a})}();var c={};N.each(function(a,b){$.extend(!0,c,$(b).serializeObject())});var e=webutils.appUrl("v2/accounts.json");c.trialProducts=d(),$.ajax({url:e,type:"POST",cache:!1,headers:{"CSRF-token":P.csrfToken.val()},data:JSON.stringify(c),contentType:"application/json"}).done(function(c){c.success||c.account.is_active?(p()&&(i(),webutils.track({siteCategory:M,eventName:"AccountCreationAPIRequestSucceed"}),webutils.track({siteCategory:"TrialRegistration",eventName:"AccountCreationAPIRequestSucceed"})),a(c)):c.errors instanceof Array?b():(c.message&&c.message.indexOf("Prohibited")!==-1,b())}).fail(function(a,c,d){p()&&(i(),webutils.track({siteCategory:M,eventName:"AccountCreationAPIRequestFailed"})),b()}),p()&&(i(),webutils.track({siteCategory:M,eventName:"AccountCreationAPIRequest"}))})}function x(){$(".js-go-to-step").on("click",function(){var a=$(this).data("step");q(a)})}function y(){function a(){var a=$(this).parent().find("input"),b=a.attr("type");a.attr("type","password"===b?"text":"password"),$(this).toggleClass("toggled","password"===b)}$(".js-toggle-password-button").on("click",a)}function z(){function a(){if("#success"!==window.location.hash&&"#error"!==window.location.hash){/* <sl:translate> */
var a="Are you sure you want to leave? Any unsaved progress will be lost.";/* </sl:translate> */
return a}}window.onbeforeunload=a}function A(){window.addEventListener("popstate",function(a){var b=$(".js-step.active").data("step"),c=a.state&&a.state.thisStep?a.state.thisStep:null;c&&c!==b&&q(a.state.thisStep,!0)})}function B(a){function b(a,b){a.is(P.company)?P.trialExtras.clearbitCompany.val(b):a.is(P.size)&&P.trialExtras.clearbitSize.val(b)}var c={};if(S.forEach(function(d){var e=a.mappedFields.indexOf(d),f=a.values[e],g=N.find('[name="'+d+'"]'),h="js-enriched";f?(c[a.mappedFields[e]]=f,g.val(f).addClass(h),p()&&g.is(P.company)&&(i(),webutils.track({siteCategory:M,eventName:"CompanyMatch"})),g.blur(),b(g,f)):g.hasClass(h)&&(g.val("").removeClass(h),b(g,""),g.blur())}),!a.isPersonalEmail){var d=P.email.val().split("@"),e=d[d.length-1].split(".")[0],f=e.trim().substring(0,50).toLowerCase().replace(formUtils.SUBDOMAIN_REGEX,"");"Zendesk"===c["account[name]"]&&(f="z3n"),P.subdomain.val(f)}}function C(){function a(a){var b=!1,c="",d=p()&&V;if(d){r(),i();var e={enrich:!1,form:N,trackingParams:{trackingSiteCategory:M,trackingEventName:"PartialLead_Sent",dataLayerEventName:"PartialLead_Sent"}};a&&(a.preventDefault(),b="a"===a.currentTarget.localName),b&&(c=$(this).attr("href")),formUtils.createLead(e).then(function(){W=!0,b&&(window.location.href=c)}).catch(function(a){console.error(a)})}}var b=$(".js-partial-lead-trigger");b.on("click",a),webutils.fireOnExit(a)}function D(){$("html.no-pass-type").length>0&&($(".ie-password-label").show().css("text-indent","0").on("click",function(){$(this).hide(),N.find(".password").trigger("focus")}),N.find(".password").on("focus",function(){$(".ie-password-label").hide()}))}function E(a){return N.find(".success-message span.subdomain").text(P.subdomain.val()),N.find(".js-product-login").attr("href","https://"+P.subdomain.val()+".zendesk.com"),Z.sellIntent&&webutils._sendToOptimizely("sell_trial_conversion"),q("success")}function F(a){p()&&(i(),webutils.track({siteCategory:M,eventName:"AccountCreationFailed"})),q("error")}function G(){function a(){var a=d.val()?d.val():P.email.val();$(".js-email-mirror").text(a),d.val(a),k.find(".js-already-verified-login").attr("href","https://"+P.subdomain.val()+".zendesk.com")}function b(){j.append(f)}var c=($(".js-resend-email-landing"),$(".js-resend-email-form")),d=c.find('[name="resend-email"]'),e=c.find(".js-field-container"),f=c.find(".js-resend-email-fields"),g=c.find(".js-loading"),h=c.find(".js-success-message"),j=c.find(".js-send-failed"),k=c.find(".js-already-verified"),l=c.find(".js-hide-after-process");formUtils.defaultInlineValidation(c),$('.js-step[data-step="step-3"] .js-submit-btn').on("click",function(b){a()});var m={fieldContainer:e,loadingMessage:g,hideCustomElements:l,resultMessage:null};c.on("submit",function(e){e.preventDefault(),g.addClass("active"),$.ajax({url:webutils.appUrl("welcomes"),method:"POST",data:{email:d.val(),subdomain:P.subdomain.val()}}).done(function(){m.resultMessage=h,p()&&(i(),webutils.track({siteCategory:M,eventName:"ResendEmailSuccess_View"}))}).fail(function(a,b,c){var d="";try{d=JSON.parse(a.responseText).error_type}catch(a){console.error(a)}finally{switch(d){case"Rate limit reached":m.resultMessage=h;break;case"Account verified":m.resultMessage=k;break;case"Invalid email":m.resultMessage=j;default:m.resultMessage=j}}p()&&(i(),m.resultMessage===k?webutils.track({siteCategory:M,eventName:"ResendEmailUnnecessary_View"}):webutils.track({siteCategory:M,eventName:"ResendEmailFail_View"}))}).always(function(d){c.find(".js-success-message, .js-error-message").removeClass("active"),a(),b(),formUtils.handleSubmissionResult(m)})})}function H(){var a,b;try{if(window.localStorage){var c=(new Date).getTime()-9e4;b=parseInt(window.localStorage.getItem("postedDetailsBasic"),10),b>c&&(a=!0),setTimeout(function(){window.localStorage.removeItem("postedDetailsBasic")},4e3)}}catch(a){}if(a){var d={url:webutils.appUrl("details-basic.json"),dataType:"json",type:"GET",crossDomain:!0,xhrFields:{withCredentials:!0}};$.ajax(d).done(function(a){a.email&&P.email.val(a.email),"undefined"!=typeof a.optIn&&(a.optIn===!0||"TRUE"===a.optIn?P.optIn.each(function(){var a=$(this).attr("type");("checkbox"===a||"radio"===a&&$(this).is('[value="TRUE"]'))&&$(this).prop("checked",!0)}):P.optIn.each(function(){var a=$(this).attr("type");"checkbox"===a?$(this).prop("checked",!1):"radio"===a&&$(this).is('[value="FALSE"]')&&$(this).prop("checked",!0)})),q("step-2")}).fail(function(a,b,c){i(),webutils.track({siteCategory:M,eventName:"DetailsAPIRequestFailed",value:{error:JSON.stringify({status:b,error:c})}})})}}function I(){f();var a=N.find(".js-change-context");a.on("change",function(){var a=$(this),b=a.val();b.indexOf("default")>-1&&(b=b.replace("default",Z.defaultTrial),b=b.split("+")),o(b)}),N.on("contextChange",function(){var a=R.filter('[data-context*="'+Z.chosenTrial+'"]'),b=R.filter('[data-context*="default"]');return 0===a.length?(R.hide().removeClass("active"),void b.show().addClass("active")):(R.each(function(){var a=$(this),b=a.data("context");b.split(",").indexOf(Z.chosenTrial)!==-1?a.show().addClass("active"):a.hide().removeClass("active")}),void h())})}function J(){null!==Z.trialSource&&P.trialSelection.parents(".js-trial-selection-container").remove()}function K(){R.not(".active").remove()}function L(){setTimeout(k,2e3),I(),l().then(function(){D(),C(),G(),A(),x(),H(),z(),y(),a(),J(),q("step-1",!0)}).catch(function(a){console.log(a)})}var M="TrialReg",N=$(".js-register-form"),O=$(".js-progress-bar-container"),P={company:N.find('input[name="account[name]"]'),country:N.find('select[name="country"]'),department:N.find('select[name="department"]'),email:N.find('input[name="owner[email]"]'),firstName:N.find('input[name="FirstName"]'),hiddenCountry:N.find('input[name="MailingCountry"]'),hiddenFullName:N.find('input[name="owner[name]"]'),industry:N.find('input[name="industry"]'),jobTitle:N.find('input[name="job"]'),lastName:N.find('input[name="LastName"]'),optIn:N.find('input[name="optinToMarketing"]'),phone:N.find('input[name="address[phone]"]'),size:N.find('select[name="account[help_desk_size]"]'),referrer:N.find('input[name="referring_url"]'),language:N.find('select[name="account[language]"]'),hiddenLanguage:N.find('input[name="language"]'),csrfToken:N.find('input[name="csrfToken"]'),currency:N.find('input[name="account[currency]"]'),elqFormName:N.find('input[name="elqFormName"]'),password:N.find('input[name="owner[password]"]'),postal:N.find('input[name="address[postal]"]'),referralSource:N.find('input[name="referralSource"]'),source:N.find('input[name="account[source]"]'),subdomain:N.find('input[name="account[subdomain]"]'),suiteTrial:N.find('input[name="account[suite_trial]"]'),supportTrialType:N.find('input[name="support_trial_type"]'),utcOffset:N.find('input[name="account[utc_offset]"]'),routine:N.find('select[name="sell_business_role_key"]'),trialSelection:N.find('input[name="trialSelection"]'),trialExtras:{clearbitCompany:N.find('input[name="trial_extras[cb_company_name]"]'),behavioral1:N.find('input[name="trial_extras[Behavioral_1__c]"]'),clearbitSize:N.find('input[name="trial_extras[cb_company_size]"]'),countryCode:N.find('input[name="trial_extras[Inferred_CCode]"]'),features:N.find('input[name="trial_extras[features]"]'),leadSourceDetail:N.find('input[name="trial_extras[lead_source_detail]"]'),productSignUp:N.find('input[name="trial_extras[product_sign_up]"]'),suiteTrial:N.find('input[name="trial_extras[suite_trial]"]'),xsellSource:N.find('input[name="trial_extras[xsell_source]"]'),sellSignupEnv:N.find('input[name="trial_extras[sell_signup_env]"]'),provisionedTrial:N.find('input[name="trial_extras[provisioned_trial]"]'),productList:N.find('input[name="trial_extras[product_list]"]'),buyNow:N.find('input[name="trial_extras[buy_now]"]'),plan:N.find('input[name="trial_extras[plan]"]')},RVaccount:N.find('input[name="rv_account"]'),RVmember:N.find('input[name="rv_member"]'),partnerAccount:N.find('input[name="partner_account"]'),partnerContact:N.find('input[name="partner_contact"]')},Q={firstName:P.firstName.parents(".js-field-wrap"),lastName:P.lastName.parents(".js-field-wrap"),jobTitle:P.jobTitle.parents(".js-field-wrap"),department:P.department.parents(".js-field-wrap")},R=N.find(".js-contextual-field"),S=["account[name]","account[help_desk_size]","industry"],T={email:P.email,first_name:P.firstName,last_name:P.lastName,phone:P.phone,postal:P.postal,company:P.company,help_desk_size:P.size,currency:P.currency,country_code:P.trialExtras.countryCode,sell_business_role_key:P.routine},U=!1,V=!1,W=!1,X="WebsiteRegisterForm",Y={zendesk_support:{productList:["zendesk_support"],trialProducts:["zendesk_support"],supportTrialType:"non_suite",leadSourceDetail:"Website Trial - Support"},zendesk_suite:{productList:["zendesk_suite"],trialProducts:["zendesk_suite"],supportTrialType:"suite",leadSourceDetail:"Website Trial - Suite"},zendesk_chat:{productList:["zendesk_chat"],trialProducts:["zendesk_suite"],supportTrialType:"suite",leadSourceDetail:"Website Trial - Chat"},zendesk_talk:{productList:["zendesk_talk"],trialProducts:["zendesk_suite"],supportTrialType:"suite",leadSourceDetail:"Website Trial - Talk"},zendesk_guide:{productList:["zendesk_guide"],trialProducts:["zendesk_suite"],supportTrialType:"suite",leadSourceDetail:"Website Trial - Guide"},zendesk_explore:{productList:["zendesk_explore"],trialProducts:["zendesk_suite"],supportTrialType:"suite",leadSourceDetail:"Website Trial - Explore"},zendesk_sunshine:{productList:["zendesk_sunshine"],trialProducts:["zendesk_suite"],supportTrialType:"suite",leadSourceDetail:"Website Trial - Sunshine"},zendesk_gather:{productList:["zendesk_gather"],trialProducts:["zendesk_suite"],supportTrialType:"suite",leadSourceDetail:"Website Trial - Gather"},zendesk_sell:{productList:["zendesk_sell"],trialProducts:["zendesk_sell"],supportTrialType:"sell",leadSourceDetail:"Website Trial - Sell"},zendesk_salessuite:{productList:["zendesk_salessuite"],trialProducts:["zendesk_sell"],supportTrialType:"salessuite",leadSourceDetail:"Website Trial - Sales Suite"},zendesk_support_sell:{productList:["zendesk_support","zendesk_sell"],trialProducts:["zendesk_support","zendesk_sell"],supportTrialType:"support_sell",leadSourceDetail:"Website Trial - Support + Sell"},zendesk_supportsuite_sell:{productList:["zendesk_suite","zendesk_sell"],trialProducts:["zendesk_suite","zendesk_sell"],supportTrialType:"supportsuite_sell",leadSourceDetail:"Website Trial - Support Suite + Sell"}},Z={trialSource:m(),productList:null,defaultTrial:null,chosenTrial:null,sellIntent:null,isSuiteTrial:null};L()});