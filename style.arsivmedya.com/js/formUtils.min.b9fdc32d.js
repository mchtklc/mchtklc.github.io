var formUtils={};!function(a){function b(b,c){b.click(function(){var b=a(this).next(".multiselect-dropdown");b.is(":visible")?(b.hide(),c.removeClass("selected")):(b.show(),c.addClass("selected"))})}function c(b){b.change(function(){var b=a(this),c=b.parent();b.prop("checked")?c.addClass("checkbox-item-active"):c.removeClass("checkbox-item-active")})}function d(a){var b=a.find('input[type="checkbox"]');b.prop("checked")?b.prop("checked",!1):b.prop("checked",!0),b.change()}function e(b){b.click(function(){d(a(this))})}function f(b){var c=[13,32];b.keypress(function(b){(c.indexOf(b.code)>-1||c.indexOf(b.keyCode)>-1||c.indexOf(b.charCode)>-1)&&d(a(this))})}function g(a){var b=a.attr("name"),c=a.attr("type");if(!c&&a.is("select")&&(c="select"),!(b&&b.length&&c&&c.length))return"";var d=m.filter(function(a){return b.indexOf(a)>-1});if(d.length)return"";var e="form:"+c+":";if(b.indexOf("[]")>-1){var f=a.attr("id");f.length||console.error("No id attribute on field:",a),e+=f}else e+=b;return e}function h(a){var b=g(a),c=b.length?localStorage.getItem(b):"";return c?JSON.parse(c):""}var i,j=["support","help"],k=["account[name]","account[help_desk_size]","industry"],l=["name","metrics.employees","category.subIndustry"];formUtils.registerMultiselectDropdownHandlers=function(){var d=a(".multiselect-container .dropdown-field"),g=a(".multiselect-container .dropdown-arrow"),h=a(".multiselect-container .checkbox-item"),i=a('.multiselect-container .checkbox-item input[type="checkbox"]');b(d,g),e(h),c(i),f(h)},formUtils.registerMulticheckboxQuestionHandlers=function(){var b=a(".multicheckbox-container .checkbox-item"),d=a('.multicheckbox-container .checkbox-item input[type="checkbox"]');e(b),c(d),f(b)};var m=["password","telesign"];formUtils.registerFieldHandlersToSaveInput=function(){var b=function(){var b=a(this),c=b.attr("name"),d=b.val(),e=h(b);if(c.length&&d!==e&&formUtils.isFieldValid(b)){var f=g(b);f.length&&localStorage.setItem(f,JSON.stringify(d))}};a("input, select").blur(b),a('input[type="checkbox"]').change(b)},formUtils.prepopulateFieldsFromLocalStorage=function(b){a("input, select").each(function(){var c=a(this);if("hidden"!==c.attr("type")){var d=h(c);d.length&&c.val()!==d&&(c.val(d),b&&b(c))}})},formUtils.isFieldValid=function(a){var b,c=a.val();if(b=a.is("select")?"select":a.is("textarea")?"textarea":a.attr("type"),!c||!b)return!1;b=b.charAt(0).toUpperCase()+b.slice(1);var d=formUtils["is"+b+"Valid"];return d&&d(c,a)},formUtils.isTextValid=function(a){return""!=a&&formUtils.utf8AlphaNum.test(a)},formUtils.isTextareaValid=function(a){return""!=a&&formUtils.utf8AlphaNum.test(a)},formUtils.isEmailValid=function(a){return formUtils.emailRegexp.test(a)&&!formUtils.isSupportEmail(a)&&!formUtils.isZendeskInstanceEmail(a)},formUtils.isSelectValid=function(a){return!!a.length&&"-"!==a},formUtils.isRadioValid=function(a,b){var c=b.parents("form");return c.find("input[name="+b.attr("name")+"]").is(":checked")},formUtils.isPasswordValid=function(a,b){var c=b.parents("form"),d=c.find("[name=owner\\[email\\]]");return a.length>=5&&a!==d.val()},formUtils.isTelValid=function(a){var b=a.replace(/[^0-9]/g,"");return/^\d+$/.test(b)&&b.length>0},formUtils.isNumberValid=function(a){return!isNaN(a)},formUtils.isCheckboxValid=function(){return!0},formUtils.isSupportEmail=function(a){var b,c;for(a=a.toLowerCase(),c=a.split("@")[0],b=0;b<j.length;b++)if(c===j[b])return!0;return!1},formUtils.isZendeskInstanceEmail=function(a){return a.toLowerCase().indexOf(".zendesk.com")!==-1},formUtils.emailRegexp=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,formUtils.utf8AlphaNum=new RegExp("[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ一-龠ぁ-んァ-ヴa-zA-Z0-9ａ-ｚＡ-Ｚ０-９ー]+");var n={trialExtraFirstTouch:"input#trial_extras\\[First_Touch__c\\]",trialExtraLastTouch:"input#trial_extras\\[Last_Touch__c\\]",trialExtraTimeOnSite:"input#trial_extras\\[Time_On_Site__c\\]",trialExtraVisits:"input#trial_extras\\[Visits__c\\]",trialExtraPageviews:"input#trial_extras\\[Visits__c\\]",trialExtraWebOffer:"input#trial_extras\\[Web_Offer__c\\]",trialExtraWebOfferName:"input#trial_extras\\[Web_Offer_Name__c\\]",legacyTrialExtraCountryCode:"input#trial_extras\\[DB_CCode__c\\]",legacyTrialExtraCountry:"input#trial_extras\\[Country__c\\]",legacyTrialExtraState:"input#trial_extras\\[DB_State__c\\]",legacyTrialExtraCity:"input#trial_extras\\[DB_City__c\\]",legacyTrialExtraZip:"input#trial_extras\\[DB_Zip__c\\]",legacyTrialExtraRegion:"input#trial_extras\\[Region__c\\]",mailingCountry:"input#MailingCountry",trialExtraCountryCode:"input#trial_extras\\[Inferred_CCode\\]",trialExtraCountry:"input#trial_extras\\[Inferred_Country\\]",trialExtraState:"input#trial_extras\\[Inferred_State\\]",trialExtraCity:"input#trial_extras\\[Inferred_City\\]",trialExtraZip:"input#trial_extras\\[Inferred_Zip\\]",trialExtraRegion:"input#trial_extras\\[Inferred_Region\\]",trialExtraIPAddress:"input#trial_extras\\[Inferred_IP_Address\\]",locationIPAddress:"input#location\\[Inferred_IP_Address\\]",accountName:"input#account\\[name\\]",accountHelpDeskSize:"input#account\\[help_desk_size\\]",industry:"input#\\[industry\\]",addressPostal:"input#address\\[postal\\]"},o=!1;formUtils.setMAVs=function(b){if(o)return formUtils.setGeoByIP();var c=cookieUtils.gauge()||{};return a(n.trialExtraFirstTouch).val(c.first_landing_page),a(n.trialExtraLastTouch).val(c.last_landing_page),a(n.trialExtraTimeOnSite).val(c.time_on_site),a(n.trialExtraVisits).val(c.visits),a(n.trialExtraPageviews).val(c.page_views),b&&(a(n.trialExtraWebOffer).val("Trial"),a(n.trialExtraWebOfferName).val("Trial")),cookieUtils.parseCookies(),o=!0,formUtils.setGeoByIP()},formUtils.setGeoByIP=function(){return new Promise(function(b,c){geoUtils.getGeoData().then(function(c){a(n.legacyTrialExtraCountryCode).val(c.country_code),a(n.legacyTrialExtraCountry).val(c.country),a(n.legacyTrialExtraState).val(c.state),a(n.legacyTrialExtraCity).val(c.city),a(n.legacyTrialExtraZip).val(c.postal),a(n.legacyTrialExtraRegion).val(c.region),a(n.mailingCountry).val(c.country),a(n.trialExtraCountryCode).val(c.country_code),a(n.trialExtraCountry).val(c.country),a(n.trialExtraState).val(c.state),a(n.trialExtraCity).val(c.city),a(n.trialExtraZip).val(c.postal),a(n.trialExtraRegion).val(c.region),a(n.trialExtraIPAddress).val(c.ipAddress),a(n.locationIPAddress).val(c.ipAddress),a(n.addressPostal).val(c.postal);var d="Geolocation",e="Success",f={};c.error?(a(n.legacyTrialExtraCountryCode).val("US"),a(n.trialExtraCountryCode).val("US"),a(n.legacyTrialExtraCountry).val("United States"),a(n.trialExtraCountry).val("United States"),a(n.mailingCountry).val("United States"),e="Error",f.error=c.error):(f.country=c.country,f.region=c.region),webutils.track({siteCategory:d,eventName:e}),b(c)}).catch(function(a){c()})})},formUtils.prepopulatePostalCodeField=function(a){formUtils.setMAVs(!1).then(function(b){a.val(b.postal),a.attr("data-postal",b.postal),a.change()}).catch(function(){})},formUtils.prepopulateCountryField=function(a){formUtils.setMAVs(!1).then(function(b){a.val(b.country),a.change()}).catch(function(){})},formUtils.scrollToError=function(b){var c=a(".js-sticky-container").outerHeight(),d=b.find(".js-field-error.field-error-active").first(),e=d.parents(".js-field-wrap");a("html, body").animate({scrollTop:e.offset().top-(c+10)},500)},formUtils.renderValidationState=function(a){var b=formUtils.isFieldValid(a),c=a.attr("type"),d=a.parents(".js-field-wrap"),e=d.find(".js-field-error");return b?(a.removeClass("field-error-active"),e&&e.removeClass("field-error-active")):(a.addClass("field-error-active"),e&&e.addClass("field-error-active")),"select"===c&&(b?a.css("color","#3d5154"):a.css("color","#809295")),b},formUtils.defaultInlineValidation=function(b,c){c=c||!1;var d,e;if(c)var f=function(){c.container.removeClass("active"),c.container.find(".field-error-active").removeClass("field-error-active"),a.each(c.fields,function(){a(this).val("")})};var g=function(){var b=a(this);"active"===b.attr("data-state")&&(window.clearTimeout(d),d=setTimeout(function(){formUtils.renderValidationState(b)},1e3))},h=function(){var b=a(this);"active"!==b.attr("data-state")&&b.attr("data-state","active")},j=function(){var b=a(this);"active"!==b.attr("data-state")&&b.attr("data-state","active"),formUtils.renderValidationState(b)},k=function(){var b,d,g=a(this),h=g.val();formUtils.renderValidationState(g)&&("active"!==g.attr("data-state")&&g.attr("data-state","active"),c&&(e?(b=e.substring(e.lastIndexOf("@")+1),d=h.substring(e.lastIndexOf("@")+1),b!==d&&(f(),i=!1)):e=h))};b.find("select").each(function(b,c){""!==a(c).val()?a(c).css("color","#3d5154"):a(c).css("color","#809295")}),b.on("keyup","input.required, textarea.required",g).on("blur change",'input[name!="owner[email]"].required, textarea.required, select.required',j).on("focus","input.required, textarea.required, select.required",h).on("blur change",'input[name="owner[email]"].required',k)},formUtils.preflightValidate=function(b){for(var c,d=b.find(".required").filter(":visible"),e=!1,f=0,g=[],h=0;h<d.length;h++,f++)g.push(formUtils.renderValidationState(a(d[h]))),h===f&&(c=!0);return e=g.indexOf(!1),c===!0&&e===-1||(webutils.isMobile()&&formUtils.scrollToError(b),!1)},formUtils.allFieldsValid=function(b){for(var c,d=b.find(".required").filter(":visible"),e=!1,f=0,g=[],h=0;h<d.length;h++,f++)g.push(formUtils.isFieldValid(a(d[h]))),h===f&&(c=!0);return e=g.indexOf(!1),c===!0&&e===-1},formUtils.preflightEnrich=function(a){return formUtils.enrichmentCheck(a).then(function(a){return formUtils.verifyEnrichment(a)}).then(function(a){return a}).catch(function(a){console.error(a)})},formUtils.enrichmentCheck=function(b){return new Promise(function(c,d){var e=(new Date).getTime();a.ajax({url:webutils.appUrl("v2/email-info.json?email="+encodeURIComponent(b)),dataType:"json",success:function(a){var b=(new Date).getTime(),d=Math.round((b-e)/1e3*2)/2;webutils.track({siteCategory:"Clearbit",eventName:"RequestTime",value:{requestTime:d}}),c(a)},error:function(a,b,c){b&&webutils.track({siteCategory:"Clearbit",eventName:"RequestError",value:{error:b}}),d()}})})},formUtils.verifyEnrichment=function(a){var b=[],c=!1;return new Promise(function(d,e){l.forEach(function(c){a.fields.indexOf(c)===-1&&b.push(!1)}),b.indexOf(!1)===-1&&(c=!0),d(c)})},formUtils.setFullNameField=function(a){var b={firstName:a.find('input[name="FirstName"]'),lastName:a.find('input[name="LastName"]'),fullName:a.find('input[name="owner[name]"]')};b.firstName&&b.lastName&&b.fullName&&b.fullName.val(b.firstName.val()+" "+b.lastName.val())},formUtils.handleSubmissionResult=function(a){a.successRedirect&&a.resultMessage.hasClass("js-success-message")&&(window.location.href=a.successRedirect),a.fieldContainer.addClass("hidden"),a.loadingMessage.removeClass("active"),a.hideCustomElements.hide(),a.resultMessage.addClass("active")},formUtils.trackFormSubmission=function(a){if(a){var b=a.trackingSiteCategory?a.trackingSiteCategory:"",c=a.trackingEventName?a.trackingEventName:"",d=(a.trackingValueDataKey?a.trackingValueDataKey:"",a.trackingValueDataValue?a.trackingValueDataValue:""),e=a.dataLayerEventName?a.dataLayerEventName:"";"error"===a.status&&(c+="Failed"),b&&c&&webutils.track({siteCategory:b,eventName:c,value:{trackingValueDataKey:d}}),e&&dataLayer.push({event:e})}},formUtils.regionalFieldDisplay=function(a,b){geoUtils.isUserInRegion("LATAM").then(function(c){c&&(b.jobTitle&&b.jobTitle.addClass("active"),b.department&&b.department.addClass("active"),b.jobTitle&&b.department&&a.hasClass("js-demo-form")&&(b.department.remove(),b.department.insertBefore(b.jobTitle)))}).catch(function(a){console.error(a)}),geoUtils.isUserInContinentCountry("AS","JP").then(function(c){c&&(b.firstName&&b.lastName&&(b.lastName.remove(),b.lastName.insertBefore(b.firstName)),b.jobTitle&&b.jobTitle.addClass("active"),b.department&&b.department.addClass("active"),b.jobTitle&&b.department&&a.hasClass("js-demo-form")&&(b.department.remove(),b.department.insertBefore(b.jobTitle)))}).catch(function(a){console.error(a)})},formUtils.createLeadAndHandleDisplay=function(b){var c,d=b.form,e=b.trackingParams,f=d.find(".js-field-container"),g=d.find(".js-loading"),h=d.find(".js-success-message"),i=d.find(".js-error-message"),j=a(".js-hide-after-process");d.find('input[name="elqFormName"]').val();g.addClass("active"),formUtils.setFullNameField(d),c=b.enrich?d.serialize()+"&enrich="+JSON.stringify(k):d.serialize();var l={fieldContainer:f,loadingMessage:g,hideCustomElements:j,successRedirect:b.successRedirect,resultMessage:""};a.post(webutils.appUrl("v3/lead"),c).done(function(a){e&&(e.status="success",formUtils.trackFormSubmission(e)),l.resultMessage=h}).fail(function(){e&&(e.status="error",formUtils.trackFormSubmission(e)),l.resultMessage=i}).always(function(){formUtils.handleSubmissionResult(l)})},formUtils.createLead=function(b){var c,d=b.form,e=b.trackingParams;return formUtils.setFullNameField(d),c=b.enrich?d.serialize()+"&enrich="+JSON.stringify(k):d.serialize(),new Promise(function(b,d){a.post(webutils.appUrl("v3/lead"),c).done(function(a){e&&(e.status="success",formUtils.trackFormSubmission(e)),b(a)}).fail(function(){e&&(e.status="error",formUtils.trackFormSubmission(e)),d()})})},formUtils.submitContactTicket=function(b){return new Promise(function(c,d){a.post(webutils.appUrl("contact"),b.serialize()).done(function(a){c(a)}).fail(function(){d()})})},formUtils.submitStartupApplication=function(b){return new Promise(function(c,d){a.post(webutils.appUrl("startups"),b.serialize()).done(function(a){c(a)}).fail(function(){d()})})}}(jQuery);