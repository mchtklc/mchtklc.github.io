$(function(){function a(){var a=new Date;return a.getTime()}function b(a,b){b=b||"impression";var c=a.find(".js-promo-title").text(),d=a.attr("data-promo-dl-location")||"grid",e="grid"===d?"grid_ad_"+a.prevAll().length:null,f=a.attr("data-promo-type");c||(c=a.find("h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6").text().replace(/\\n/g,"").trim());var g={event:"ad_"+b,title:c,placement:d,position:e,type:f};dataLayer.push(g)}function c(){var a=[],d=[];n.forEach(function(c){return c.on("click","a",function(){b(c,"click")}),"navigation"===c.attr("data-promo-dl-location")?void c.parents(".has-dropdown").one("mouseover",function(){b(c)}):void(c.offset().top<window.pageYOffset+window.innerHeight?a.push(c):d.push(c))}),n=d,a.forEach(function(a){b(a)}),$(window).one("scroll",webutils.debounce(c,300))}function d(){var b=!0;return new Promise(function(c,d){var e,f,g=6e5;e=localStorage.getItem("blogStorage"),f=JSON.parse(e);var h=a();return f&&f.timestamp&&h-f.timestamp<g?(b=!1,void c(f.payload)):void $.get("/blog-ads-api-output/").done(function(b){var e=JSON.parse(b);try{localStorage.setItem("blogStorage",JSON.stringify({timestamp:a(),payload:e}))}catch(a){console.error("error:",a),d(a)}finally{c(e)}})})}function e(a){return new Promise(function(b,c){var d=[];0===a.length&&c(),a.forEach(function(a){var b=f(a);0!==b.length&&b&&(g(a,b),d.push(b),n.push(b))}),m=d,l.not("."+o).remove(),b(d)})}function f(a){function b(a){var b={};for(var c in a)if(0===c.indexOf("promo")&&0!==c.indexOf("promoDl")){var d=c.replace("promo","").toLowerCase();b[d]=a[c]}return b}var c=l.filter(function(c,d){var e=$(d),f=b(e.data()),g=0;if(e.hasClass(o))return!1;for(var h in f){var i=f[h],j=h.replace("promo","").toLowerCase();a[j]===i&&g++}return g===Object.keys(f).length});return c.eq(0)}function g(a,b){b.attr("data-promo-id",a.id);var c=b.find(".js-promo-image");if(void 0!==c.attr("data-src")?c.attr("data-src",a.image):c.removeClass("lazyloading").attr("src",a.image),b.find(".js-promo-title").html(a.heading),b.find(".js-promo-body").html(a.copy),b.find(".js-promo-link").attr("href",a.url),a.shape&&b.find(".js-promo-image-shape").addClass("relationframe-"+a.shape),a.post_type){var d="post-type-"+a.post_type.replace(/[^A-Za-z]/g,"").toLowerCase();b.find(".js-promo-post-type").text(a.post_type).addClass(d)}else b.find(".js-promo-post-type").remove();b.next().length>0&&b.nextAll().last().remove(),b.addClass(o)}function h(){p&&l.each(function(){$(this).append('<a class="promo-edit-button" href="/th/wp-admin/post.php?post='+$(this).attr("data-promo-id")+'&action=edit">Edit Blog Ad</a>')})}function i(){return new Promise(function(a,b){var c=l.filter(".promo-zone-active");c.each(function(){n.push($(this))}),a()})}function j(){k.indexOf(geoUtils.getLocale())===-1&&i().then(d).then(e).then(c).then(h).catch(function(a){console.error(a)})}var k=["ko-kr","th-th","zh-cn","zh-tw"],l=$(".js-promo-zone");if(0!==l.length){var m=[],n=[],o="promo-zone-active",p=null!==document.getElementById("wpadminbar");j()}});